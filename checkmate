#!/usr/bin/env python3
from argparse import ArgumentParser
import logging

from input import Input

if __name__ == '__main__':
    # set signal handler to OS default so that console interrupts behave as expected
    # this is usually "terminate reasonably rapidly" for SIGINT
    # Python's default is "wait around for any native code, then consider KeyboardInterrupt on a good day"
    from signal import SIGINT, SIG_DFL, signal
    signal(SIGINT, SIG_DFL)

    logging.basicConfig(
        level=logging.INFO,
        format='[%(levelname)s] %(message)s'
    )

    parser = ArgumentParser(
        description="check game-theoretic security properties of off-chain protocols"
    )
    parser.add_argument(
        'GAME',
        type=str,
        help="path to JSON encoding of input game"
    )

    args = parser.parse_args()
    loaded = Input(args.GAME)
    logging.info("loaded input")

    for honest_history in loaded.honest_histories:
        logging.info(f"honest history: {honest_history}")
        loaded.start_honest_history(honest_history)
        loaded.property('weak_immunity')
        loaded.property('weaker_immunity')
        loaded.property('collusion_resilience')
        loaded.property('practicality')
